<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KodNest Premium - Job Notification Tracker</title>
    <link rel="stylesheet" href="kodnest-premium.css">
</head>

<body>

    <!-- Top Bar: Fixed at top -->
    <header class="top-bar">
        <div class="project-name">KodNest Premium</div>

        <nav class="main-nav" id="main-nav">
            <a href="#/" class="nav-link" data-route="/">Home</a>
            <a href="#/dashboard" class="nav-link" data-route="/dashboard">Dashboard</a>
            <a href="#/saved" class="nav-link" data-route="/saved">Saved</a>
            <a href="#/digest" class="nav-link" data-route="/digest">Digest</a>
            <a href="#/settings" class="nav-link" data-route="/settings">Settings</a>
            <a href="#/jt/07-test" class="nav-link" data-route="/jt/07-test">Test</a>
            <a href="#/jt/08-ship" class="nav-link" data-route="/jt/08-ship">Ship</a>
            <a href="#/proof" class="nav-link" data-route="/proof">Proof</a>
        </nav>

        <div class="status-area">
            <button class="menu-toggle" id="menu-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <span class="status-badge status-progress">In Progress</span>
        </div>
    </header>

    <!-- Dynamic Content Area -->
    <div id="app-root">
        <!-- Content will be injected here by JavaScript -->
    </div>

    <!-- Proof Footer: Persistent -->
    <footer class="proof-footer">
        <div class="proof-checklist">
            <label class="proof-item">
                <input type="checkbox"> UI Built
            </label>
            <label class="proof-item">
                <input type="checkbox"> Logic Working
            </label>
            <label class="proof-item">
                <input type="checkbox"> Test Passed
            </label>
            <label class="proof-item">
                <input type="checkbox"> Deployed
            </label>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="job-modal">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">&times;</button>
            <div id="modal-body">
                <!-- Modal content will be injected here -->
            </div>
        </div>
    </div>

    <script src="jobs-data.js"></script>
    <script>
        // State Management
        let savedJobs = JSON.parse(localStorage.getItem('savedJobs')) || [];
        let prefs = JSON.parse(localStorage.getItem('jobTrackerPreferences')) || null;
        let jobStatuses = JSON.parse(localStorage.getItem('jobTrackerStatus')) || {};
        let statusHistory = JSON.parse(localStorage.getItem('jobTrackerStatusHistory')) || [];
        let testChecklist = JSON.parse(localStorage.getItem('testChecklist')) || Array(10).fill(false);

        // Test Checklist Definitions
        const testItems = [
            { label: "Preferences persist after refresh", tip: "Set settings, refresh page, check if form is filled." },
            { label: "Match score calculates correctly", tip: "Verify % match against scoring rules for a specific job." },
            { label: "Show only matches toggle works", tip: "Enable toggle on dashboard, verify low score jobs disappear." },
            { label: "Save job persists after refresh", tip: "Save a job, refresh, check Saved tab." },
            { label: "Apply opens in new tab", tip: "Click Apply button, verify new browser tab opens." },
            { label: "Status update persists after refresh", tip: "Change status, refresh, verify badge remains." },
            { label: "Status filter works correctly", tip: "Filter by Applied/Rejected on dashboard." },
            { label: "Digest generates top 10 by score", tip: "Check Digest tab for top ranked jobs." },
            { label: "Digest persists for the day", tip: "Verify status log and top 10 remain visible." },
            { label: "No console errors on main pages", tip: "Open DevTools (F12) and check Console tab." }
        ];

        // Route Configuration
        const routes = {
            '/': { type: 'hero', title: 'Stop Missing The Right Jobs.', subtext: 'Precision-matched job discovery delivered daily at 9AM.' },
            '/dashboard': { type: 'jobs', title: 'Job Dashboard' },
            '/saved': { type: 'saved', title: 'Saved Jobs' },
            '/digest': { type: 'digest', title: 'Weekly Digest' },
            '/jt/07-test': { type: 'test', title: 'Test Checklist' },
            '/jt/08-ship': { type: 'ship', title: 'System Deployment' },
            '/settings': { type: 'settings', title: 'Preferences', subtext: 'Configure your career focus for intelligent matching.' },
            '/proof': { type: 'standard', title: 'Proof', emptyTitle: 'Artifact Workspace', emptySubtext: 'Placeholder for premium system proof.' }
        };

        // UI Helpers
        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerText = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateJobStatus(jobId, status) {
            const job = jobs.find(j => j.id === jobId);
            jobStatuses[jobId] = status;
            localStorage.setItem('jobTrackerStatus', JSON.stringify(jobStatuses));

            // Log history for digest
            const historyEntry = {
                title: job.title,
                company: job.company,
                status: status,
                date: new Date().toLocaleDateString('en-IN', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' })
            };
            statusHistory.unshift(historyEntry);
            if (statusHistory.length > 20) statusHistory.pop();
            localStorage.setItem('jobTrackerStatusHistory', JSON.stringify(statusHistory));

            showToast(`Status updated: ${status}`);
            router();
        }

        // Match Score Engine
        function calculateMatchScore(job) {
            if (!prefs) return 0;

            let score = 0;
            const userKeywords = prefs.roleKeywords.split(',').map(k => k.trim().toLowerCase()).filter(k => k);
            const userSkills = prefs.skills.split(',').map(s => s.trim().toLowerCase()).filter(s => s);
            const userLocations = prefs.preferredLocations || [];
            const userModes = prefs.preferredMode || [];

            if (userKeywords.some(k => job.title.toLowerCase().includes(k))) score += 25;
            else if (userKeywords.some(k => job.description.toLowerCase().includes(k))) score += 15;

            if (userLocations.some(l => job.location.includes(l))) score += 15;
            if (userModes.includes(job.mode)) score += 10;
            if (job.experience === prefs.experienceLevel) score += 10;

            const jobSkills = job.skills.map(s => s.toLowerCase());
            if (userSkills.some(us => jobSkills.includes(us))) score += 15;

            if (job.postedDaysAgo <= 2) score += 5;
            if (job.source === 'LinkedIn') score += 5;

            return Math.min(score, 100);
        }

        function getScoreClass(score) {
            if (score >= 80) return 'score-high';
            if (score >= 60) return 'score-mid';
            if (score >= 40) return 'score-neutral';
            return 'score-low';
        }

        // UI Components
        function createJobCard(job, isSavedPage = false) {
            const isSaved = savedJobs.includes(job.id);
            const score = calculateMatchScore(job);
            const showScore = prefs !== null;
            const status = jobStatuses[job.id] || 'Not Applied';
            const statusSlug = status.toLowerCase().replace(' ', '-');

            return `
                <div class="card job-card">
                    <div class="job-card-header">
                        <div>
                            <div class="job-card-title">${job.title}</div>
                            <div class="job-card-company">${job.company}</div>
                            <div class="badge-status status-${statusSlug}" style="margin-top: 4px; display: inline-block;">${status}</div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: flex-start;">
                            ${showScore ? `<div class="badge-score ${getScoreClass(score)}">${score}% Match</div>` : ''}
                            <div class="badge badge-source">${job.source}</div>
                        </div>
                    </div>
                    <div class="job-meta">
                        <div class="job-meta-item">üìç ${job.location} <span class="badge badge-mode">${job.mode}</span></div>
                        <div class="job-meta-item">üíº ${job.experience}</div>
                        <div class="job-meta-item">üí∞ ${job.salaryRange}</div>
                        <div class="job-meta-item" style="margin-left: auto;">üïí ${job.postedDaysAgo === 0 ? 'Today' : job.postedDaysAgo + ' days ago'}</div>
                    </div>
                    <div class="job-actions" style="flex-wrap: wrap; gap: 8px;">
                        <button class="btn btn-secondary" onclick="viewJob(${job.id})" style="padding: 6px 12px; font-size: 12px;">View</button>
                        <button class="btn btn-secondary" onclick="toggleSave(${job.id})" style="padding: 6px 12px; font-size: 12px; color: ${isSaved ? 'var(--color-accent)' : ''};">
                            ${isSaved ? '‚òÖ Saved' : '‚òÜ Save'}
                        </button>
                        
                        <div style="display: flex; gap: 4px; background: rgba(0,0,0,0.03); padding: 2px; border-radius: 6px; margin-left: auto;">
                            <button class="btn btn-secondary" onclick="updateJobStatus(${job.id}, 'Applied')" style="padding: 4px 8px; font-size: 10px; border: none; background: ${status === 'Applied' ? 'rgba(0,102,204,0.1)' : 'transparent'}">Apply</button>
                            <button class="btn btn-secondary" onclick="updateJobStatus(${job.id}, 'Rejected')" style="padding: 4px 8px; font-size: 10px; border: none; background: ${status === 'Rejected' ? 'rgba(139,0,0,0.1)' : 'transparent'}">Reject</button>
                            <button class="btn btn-secondary" onclick="updateJobStatus(${job.id}, 'Selected')" style="padding: 4px 8px; font-size: 10px; border: none; background: ${status === 'Selected' ? 'rgba(79,109,88,0.1)' : 'transparent'}">Select</button>
                        </div>

                        <a href="${job.applyUrl}" target="_blank" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; text-decoration: none;">External Apply</a>
                    </div>
                </div>
            `;
        }

        function renderFilters() {
            return `
                <div class="filter-bar">
                    <input type="text" class="filter-input" id="search-input" placeholder="Keyword search..." oninput="applyFilters()">
                    <select class="filter-select" id="location-filter" onchange="applyFilters()">
                        <option value="">All Locations</option>
                        <option value="Bengaluru">Bengaluru</option>
                        <option value="Hyderabad">Hyderabad</option>
                        <option value="Remote">Remote</option>
                        <option value="Mumbai">Mumbai</option>
                        <option value="Pune">Pune</option>
                        <option value="Gurugram">Gurugram</option>
                    </select>
                    <select class="filter-select" id="mode-filter" onchange="applyFilters()">
                        <option value="">All Modes</option>
                        <option value="Remote">Remote</option>
                        <option value="Hybrid">Hybrid</option>
                        <option value="Onsite">Onsite</option>
                    </select>
                    <select class="filter-select" id="exp-filter" onchange="applyFilters()">
                        <option value="">All Experience</option>
                        <option value="Fresher">Fresher</option>
                        <option value="0-1">0-1 Years</option>
                        <option value="1-3">1-3 Years</option>
                        <option value="3-5">3-5 Years</option>
                    </select>
                    <select class="filter-select" id="source-filter" onchange="applyFilters()">
                        <option value="">All Sources</option>
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="Naukri">Naukri</option>
                        <option value="Indeed">Indeed</option>
                    </select>
                    <select class="filter-select" id="status-filter" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="Not Applied">Not Applied</option>
                        <option value="Applied">Applied</option>
                        <option value="Rejected">Rejected</option>
                        <option value="Selected">Selected</option>
                    </select>
                    <select class="filter-select" id="sort-dropdown" onchange="applyFilters()">
                        <option value="latest">Sort: Latest</option>
                        <option value="score">Sort: Match Score</option>
                        <option value="salary">Sort: Salary</option>
                    </select>
                    ${prefs ? `
                        <label class="checkbox-item" style="margin-left: auto;">
                            <input type="checkbox" id="match-only-toggle" onchange="applyFilters()"> Match Threshold
                        </label>
                    ` : ''}
                </div>
            `;
        }

        // Logic Functions
        function applyFilters() {
            const searchInput = document.getElementById('search-input');
            const locFilter = document.getElementById('location-filter');
            const modeFilter = document.getElementById('mode-filter');
            const expFilter = document.getElementById('exp-filter');
            const sourceFilter = document.getElementById('source-filter');
            const statusFilter = document.getElementById('status-filter');
            const sortDropdown = document.getElementById('sort-dropdown');
            const matchOnly = document.getElementById('match-only-toggle');

            if (!searchInput || !locFilter || !modeFilter || !expFilter || !sourceFilter || !statusFilter) return;

            const search = searchInput.value.toLowerCase();
            const loc = locFilter.value;
            const mode = modeFilter.value;
            const exp = expFilter.value;
            const source = sourceFilter.value;
            const status = statusFilter.value;
            const sortBy = sortDropdown.value;

            let filtered = jobs.filter(j => {
                const matchesSearch = j.title.toLowerCase().includes(search) || j.company.toLowerCase().includes(search);
                const matchesLoc = !loc || j.location.includes(loc);
                const matchesMode = !mode || j.mode === mode;
                const matchesExp = !exp || j.experience === exp;
                const matchesSource = !source || j.source === source;
                const matchesStatus = !status || (jobStatuses[j.id] || 'Not Applied') === status;

                let matchesThreshold = true;
                if (matchOnly && matchOnly.checked && prefs) {
                    matchesThreshold = calculateMatchScore(j) >= prefs.minMatchScore;
                }

                return matchesSearch && matchesLoc && matchesMode && matchesExp && matchesSource && matchesStatus && matchesThreshold;
            });

            // Sorting
            filtered.sort((a, b) => {
                if (sortBy === 'latest') return a.postedDaysAgo - b.postedDaysAgo;
                if (sortBy === 'score') return calculateMatchScore(b) - calculateMatchScore(a);
                if (sortBy === 'salary') {
                    const getSalary = (str) => {
                        const match = str.match(/(\d+)/);
                        return match ? parseInt(match[1]) : 0;
                    };
                    return getSalary(b.salaryRange) - getSalary(a.salaryRange);
                }
                return 0;
            });

            const grid = document.getElementById('job-grid');
            if (!grid) return;

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <h2 class="text-muted">No roles match your criteria.</h2>
                        <p class="text-muted">Adjust filters or lower your threshold in settings.</p>
                    </div>`;
            } else {
                grid.innerHTML = filtered.map(j => createJobCard(j)).join('');
            }
        }

        function toggleSave(id) {
            if (savedJobs.includes(id)) {
                savedJobs = savedJobs.filter(sid => sid !== id);
            } else {
                savedJobs.push(id);
            }
            localStorage.setItem('savedJobs', JSON.stringify(savedJobs));
            router(); // Re-render to update UI
        }

        function savePreferences() {
            const roleKeywords = document.getElementById('roleKeywords').value;
            const selectedLocs = Array.from(document.getElementById('preferredLocations').selectedOptions).map(o => o.value);
            const selectedModes = Array.from(document.querySelectorAll('input[name="preferredMode"]:checked')).map(i => i.value);
            const experienceLevel = document.getElementById('experienceLevel').value;
            const skills = document.getElementById('skills-prefs').value;
            const minMatchScore = parseInt(document.getElementById('minMatchScore').value);

            prefs = { roleKeywords, preferredLocations: selectedLocs, preferredMode: selectedModes, experienceLevel, skills, minMatchScore };
            localStorage.setItem('jobTrackerPreferences', JSON.stringify(prefs));

            showToast("Preferences saved.");
            window.location.hash = "#/dashboard";
        }

        function viewJob(id) {
            const job = jobs.find(j => j.id === id);
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = `
                <h2 style="margin-bottom: 8px;">${job.title}</h2>
                <div class="job-card-company" style="font-size: 18px; margin-bottom: 24px;">${job.company}</div>
                <h3 style="font-size: 14px; margin-bottom: 8px;">DESCRIPTION</h3>
                <p class="text-muted" style="margin-bottom: 24px;">${job.description}</p>
                <h3 style="font-size: 14px; margin-bottom: 12px;">SKILLS</h3>
                <div style="margin-bottom: 32px;">
                    ${job.skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}
                </div>
                <a href="${job.applyUrl}" target="_blank" class="btn btn-primary" style="width: 100%; text-decoration: none;">Apply Externally</a>
            `;
            document.getElementById('job-modal').classList.add('open');
        }

        function toggleTestItem(index) {
            testChecklist[index] = !testChecklist[index];
            localStorage.setItem('testChecklist', JSON.stringify(testChecklist));
            router();
        }

        function resetTests() {
            if (confirm("Reset all test states?")) {
                testChecklist = Array(10).fill(false);
                localStorage.setItem('testChecklist', JSON.stringify(testChecklist));
                router();
            }
        }

        // Router Implementation
        function router() {
            const path = window.location.hash.slice(1) || '/';
            const route = routes[path] || routes['/'];
            const app = document.getElementById('app-root');

            // SHIP LOCK Logic
            const totalPassed = testChecklist.filter(t => t).length;
            if (path === '/jt/08-ship' && totalPassed < 10) {
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            <div class="ship-locked">
                                <span class="lock-icon">üîí</span>
                                <h2>Route Locked</h2>
                                <p class="text-muted" style="margin-bottom: 24px;">System deployment is disabled until all testing requirements are met.</p>
                                <div class="badge-status status-rejected" style="font-size: 14px; padding: 12px 24px;">${totalPassed} / 10 Tests Passed</div>
                                <div style="margin-top: 32px;">
                                    <a href="#/jt/07-test" class="btn btn-primary">Go to Test Checklist</a>
                                </div>
                            </div>
                        </article>
                    </main>
                `;
            } else if (route.type === 'hero') {
                app.innerHTML = `
                    <section class="context-header hero-section">
                        <h1>${route.title}</h1>
                        <p class="subtext">${route.subtext}</p>
                        <a href="#/settings" class="btn btn-primary">Start Tracking</a>
                    </section>
                `;
            } else if (route.type === 'jobs') {
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace" style="flex: 0 0 100%;">
                            ${!prefs ? `<div class="banner"><div class="banner-text">Set your preferences to activate intelligent matching.</div><a href="#/settings" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Settings</a></div>` : ''}
                            ${renderFilters()}
                            <div class="job-grid" id="job-grid"></div>
                        </article>
                    </main>
                `;
                applyFilters();
            } else if (route.type === 'saved') {
                const savedList = jobs.filter(j => savedJobs.includes(j.id));
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            ${savedList.length === 0 ?
                        `<div class="empty-state"><h2>No saved jobs.</h2></div>` :
                        `<div class="job-grid">${savedList.map(j => createJobCard(j, true)).join('')}</div>`
                    }
                        </article>
                    </main>
                `;
            } else if (route.type === 'digest') {
                // Top 10 Match Logic
                const topJobs = [...jobs]
                    .map(j => ({ ...j, score: calculateMatchScore(j) }))
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 10);

                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            <div class="card" style="margin-bottom: 24px;">
                                <h2>Top 10 Matches</h2>
                                <p class="text-muted" style="margin-bottom: 20px;">Precision-selected based on your recent activity and saved profile.</p>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    ${topJobs.map((j, i) => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid var(--color-border); border-radius: 6px;">
                                            <div>
                                                <span style="font-weight: bold; margin-right: 8px;">#${i + 1}</span>
                                                ${j.title} at ${j.company}
                                            </div>
                                            <div class="badge-score ${getScoreClass(j.score)}">${j.score}%</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="card">
                                <h2>Recent Status Updates</h2>
                                ${statusHistory.length === 0 ?
                        `<p class="text-muted">No recent activity detected.</p>` :
                        `<div style="display: flex; flex-direction: column; gap: 16px;">
                                        ${statusHistory.map(entry => `
                                            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 12px;">
                                                <div>
                                                    <div style="font-weight: 600;">${entry.title}</div>
                                                    <div class="text-muted" style="font-size: 12px;">${entry.company}</div>
                                                </div>
                                                <div style="text-align: right;">
                                                    <div class="badge-status status-${entry.status.toLowerCase().replace(' ', '-')}" style="display: inline-block;">${entry.status}</div>
                                                    <div class="text-muted" style="font-size: 11px; margin-top: 4px;">${entry.date}</div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>`
                    }
                            </div>
                        </article>
                    </main>
                `;
            } else if (route.type === 'test') {
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            <div class="test-summary">
                                <h2>Tests Passed: ${totalPassed} / 10</h2>
                                ${totalPassed < 10 ?
                        `<p class="status-rejected badge" style="padding: 4px 12px; border-radius: 4px;">Resolve all issues before shipping.</p>` :
                        `<p class="status-selected badge" style="padding: 4px 12px; border-radius: 4px;">System ready for deployment.</p>`
                    }
                                <div style="margin-top: 16px;">
                                    <button class="btn btn-secondary" onclick="resetTests()" style="padding: 6px 12px; font-size: 12px;">Reset Test Status</button>
                                </div>
                            </div>
                            <div class="checklist-container">
                                ${testItems.map((item, i) => `
                                    <div class="checklist-item">
                                        <input type="checkbox" ${testChecklist[i] ? 'checked' : ''} onclick="toggleTestItem(${i})">
                                        <div class="checklist-content">
                                            <span class="checklist-label">${item.label}</span>
                                            <span class="checklist-tooltip">How to test: ${item.tip}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="margin-top: 32px; text-align: center;">
                                <a href="#/jt/08-ship" class="btn btn-primary" ${totalPassed < 10 ? 'style="opacity: 0.5; pointer-events: none;"' : ''}>Continue to Shipping</a>
                            </div>
                        </article>
                    </main>
                `;
            } else if (route.type === 'ship') {
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            <div class="card" style="text-align: center; padding: 64px 24px;">
                                <div style="font-size: 64px; margin-bottom: 24px;">üöÄ</div>
                                <h2>Deployment Ready</h2>
                                <p class="text-muted" style="margin-bottom: 32px;">All quality gates passed. System is verified and ready for production.</p>
                                <button class="btn btn-primary" onclick="alert('Deployment initiated: Job Tracker v1.0')">Initiate Final Ship</button>
                            </div>
                        </article>
                    </main>
                `;
            } else if (route.type === 'settings') {
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1><p class="subtext">${route.subtext}</p></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            <div class="card">
                                <h2>Search Profile</h2>
                                <div class="grid-2">
                                    <div class="input-group">
                                        <label class="label">Role Keywords (comma-separated)</label>
                                        <input type="text" class="input-field" id="roleKeywords" placeholder="e.g. Frontend, Java" value="${prefs ? prefs.roleKeywords : ''}">
                                    </div>
                                    <div class="input-group">
                                        <label class="label">Preferred Locations (Multi-select)</label>
                                        <select class="input-field" id="preferredLocations" multiple style="height: 100px;">
                                            <option value="Bengaluru" ${prefs?.preferredLocations.includes('Bengaluru') ? 'selected' : ''}>Bengaluru</option>
                                            <option value="Hyderabad" ${prefs?.preferredLocations.includes('Hyderabad') ? 'selected' : ''}>Hyderabad</option>
                                            <option value="Remote" ${prefs?.preferredLocations.includes('Remote') ? 'selected' : ''}>Remote</option>
                                            <option value="Mumbai" ${prefs?.preferredLocations.includes('Mumbai') ? 'selected' : ''}>Mumbai</option>
                                            <option value="Pune" ${prefs?.preferredLocations.includes('Pune') ? 'selected' : ''}>Pune</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid-2">
                                    <div class="input-group">
                                        <label class="label">Work Mode</label>
                                        <div class="checkbox-group">
                                            <label class="checkbox-item"><input type="checkbox" name="preferredMode" value="Remote" ${prefs?.preferredMode.includes('Remote') ? 'checked' : ''}> Remote</label>
                                            <label class="checkbox-item"><input type="checkbox" name="preferredMode" value="Hybrid" ${prefs?.preferredMode.includes('Hybrid') ? 'checked' : ''}> Hybrid</label>
                                            <label class="checkbox-item"><input type="checkbox" name="preferredMode" value="Onsite" ${prefs?.preferredMode.includes('Onsite') ? 'checked' : ''}> Onsite</label>
                                        </div>
                                    </div>
                                    <div class="input-group">
                                        <label class="label">Experience Level</label>
                                        <select class="input-field" id="experienceLevel">
                                            <option value="Fresher" ${prefs?.experienceLevel === 'Fresher' ? 'selected' : ''}>Fresher</option>
                                            <option value="0-1" ${prefs?.experienceLevel === '0-1' ? 'selected' : ''}>0-1 Years</option>
                                            <option value="1-3" ${prefs?.experienceLevel === '1-3' ? 'selected' : ''}>1-3 Years</option>
                                            <option value="3-5" ${prefs?.experienceLevel === '3-5' ? 'selected' : ''}>3-5 Years</option>
                                            <option value="5+" ${prefs?.experienceLevel === '5+' ? 'selected' : ''}>5+ Years</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid-2">
                                    <div class="input-group">
                                        <label class="label">Skills (comma-separated)</label>
                                        <input type="text" class="input-field" id="skills-prefs" placeholder="e.g. React, Java, SQL" value="${prefs ? prefs.skills : ''}">
                                    </div>
                                    <div class="input-group">
                                        <label class="label">Minimum Match Score Threshold: <span id="score-val">${prefs ? prefs.minMatchScore : 40}</span>%</label>
                                        <input type="range" id="minMatchScore" min="0" max="100" value="${prefs ? prefs.minMatchScore : 40}" oninput="document.getElementById('score-val').innerText = this.value">
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="savePreferences()" style="margin-top: 24px;">Save Preferences</button>
                            </div>
                        </article>
                    </main>
                `;
            } else {
                app.innerHTML = `
                    <section class="context-header"><h1>${route.title}</h1></section>
                    <main class="main-container">
                        <article class="primary-workspace">
                            <div class="empty-state"><h2 class="text-muted">${route.emptyTitle}</h2><p class="text-muted">${route.emptySubtext}</p></div>
                        </article>
                    </main>
                `;
            }

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.getAttribute('data-route') === path);
            });
            document.getElementById('main-nav').classList.remove('open');
        }

        // Global Event Listeners
        window.addEventListener('hashchange', router);
        window.addEventListener('load', router);
        document.getElementById('menu-toggle').addEventListener('click', () => {
            document.getElementById('main-nav').classList.toggle('open');
        });
        document.getElementById('modal-close').addEventListener('click', () => {
            document.getElementById('job-modal').classList.remove('open');
        });
        window.onclick = (event) => {
            if (event.target == document.getElementById('job-modal')) {
                document.getElementById('job-modal').classList.remove('open');
            }
        };
    </script>
</body>

</html>